Initialize:
	printflush message1
	set maxUnits 4
	set unitType @flare
	set runCount 0
	set unitCount 0

GetLinks:
	set switch switch1
	jump GetLinks equal switch null

Start:	
CheckActive:
	sensor active switch @enabled
	jump Bind equal active true

	set unitCount 0
	set runCount 0
	set firstUnit null
	jump Start always
	
Bind:
	ubind unitType
	jump NoUnits equal @unit null
	sensor isDead @unit @dead
	jump Start equal isDead true
	jump FinishGroup equal firstUnit @unit
	jump ProcessUnit notEqual firstUnit null

StartGroup:
	set firstUnit @unit

ProcessUnit:
	jump IgnoreUnit greaterThanEq unitCount maxUnits
	 # do stuff with unit
	op add processFlag unitCount 1
	op add processFlag processFlag runFlag
	ucontrol flag processFlag
	jump Next always

IgnoreUnit:
	op mul ignoreFlag runFlag 10
	op add ignoreFlag ignoreFlag 99
	ucontrol flag ignoreFlag

Next:
	op add unitCount unitCount 1
	sensor currentFlag @unit @flag
	print currentFlag
	print "\n"
	jump Start notEqual unitCount maxUnits

MaxReached:
	sensor currentFlag @unit @flag
	op mul maxFlag currentFlag -1
	ucontrol flag maxFlag
	print "Max reached at "
	print unitCount
	print "\n"
	jump Start always

FinishGroup:
	set lastCount unitCount
	set unitCount 0
	set firstUnit null
	op add runCount runCount 1
	op mul runFlag runCount 10

	print "Total: "
	print lastCount
    print "\nRun: "
	print runCount
	printflush message1
	jump Start always

NoUnits:
	print "No "
	print unitType
	print "s were found"
	printflush message1
	jump Start always




	


