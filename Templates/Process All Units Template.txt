Initialize:
	printflush message1
	set maxUnitIndex 37 #Serpulo

GetLinks:
	set switch switch1
	jump GetLinks equal switch null

Start:
GetUnitType:
	lookup unit unitType unitIndex
	set firstUnit null
	set unitCount 0

GetNextUnit:
CheckActive:
	sensor active switch @enabled
	jump BindUnit equal active true
	
	Disabled:
		set unitIndex 0
		set firstUnit null
		jump Start always

BindUnit:
	ubind unitType
	jump NextUnitType equal @unit null
	sensor isDead @unit @dead
	jump GetNextUnit equal isDead true
	jump FinishGroup equal firstUnit @unit
  	jump ProcessUnit notEqual firstUnit null

StartGroup:
	set firstUnit @unit

ProcessUnit:
	sensor flag @unit @flag
	print flag
	
FinishUnit:
	print "\n"
	op add unitCount unitCount 1
	jump GetNextUnit notEqual firstUnit @unit

FinishGroup:
	print "total: "
	print unitCount
	print "\n\n"

NextUnitType:
	op add unitIndex unitIndex 1
	jump GetUnitType lessThanEq unitIndex maxUnitIndex
	
Finish:
	set unitIndex 0
	printflush message1
	jump Start always
