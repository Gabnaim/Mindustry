Initialize:
	printflush message1
	set maxIndex 37 #Serpulo
	set showFlag true
	set showCarried true
	set showHealth true
	op or showLine showFlag showCarried
	op or showLine showLine showHealth

Start:
GetUnitType:
	lookup unit unitType unitIndex
	set firstUnit null
	set units 0

BindUnit:
	ubind unitType
	jump NextUnitType equal @unit null
	sensor dead @unit @dead
	jump BindUnit equal dead true
  	jump FinishGroup equal firstUnit @unit
	jump ProcessUnit notEqual firstUnit null
	
SetFirst:
	set firstUnit @unit

ProcessUnit:
	jump FinishUnit equal showLine false
	set hasData false
	PrintFlag:
		jump PrintCarried equal showFlag false
		sensor flag @unit @flag
		jump PrintCarried equal flag 0
		set hasData true
		print flag
		print " "
	
	PrintCarried:
		jump PrintHealth equal showCarried false
		sensor carried @unit @totalItems
		jump PrintHealth equal carried 0
		sensor material @unit @firstItem
		set hasData true
		print carried
		print " "
		print material
		print " "

	PrintHealth:
		jump PrintEnd equal showHealth false
		sensor maxHealth @unit @maxHealth
		sensor health @unit @health
		jump PrintEnd equal health maxHealth
		op mul health health 100
		op idiv healthPct health maxHealth
		set hasData true
		print healthPct
		print "%"
		
	PrintEnd:
		jump FinishUnit equal hasData false
		print "\n"
	
FinishUnit:
	op add units units 1
	jump BindUnit always

FinishGroup:
	print unitType
	print ": "
	print units
	print "\n"

NextUnitType:
	op add unitIndex unitIndex 1
	jump GetUnitType lessThanEq unitIndex maxIndex
	
Finish:
	set unitIndex 0
	printflush message1
	jump Start always
