Initialize:
	set unitType @zenith
	set idle 0
	set running 1
	set stopping 2
	set mode running

	#targetType: "unit", "building"
	set targetType "unit"
	
	GetLinks:
		set switch switch1
		set scout hail1
		jump GetLinks equal switch null
		jump GetLinks equal scout null

	GetUnitStats:
		ubind unitType
		jump GetUnitStats equal @unit null
		sensor range @unit @range
		op sub range range 2
		op floor range range
		sensor maxHealth @unit @maxHealth
		
Start:
CheckActive:
	sensor active switch @enabled
	jump BindUnit equal active true
	jump Start equal mode idle
	jump Stopping always

BindUnit:
	set mode running
	ubind unitType
	jump Start equal @unit null
	sensor unitDead @unit @dead
	jump Start equal unitDead true
	sensor flag @unit @flag
	jump Start notEqual flag 0
	set currentUnit @unit

CheckHealth:
	sensor health currentUnit @health
	op div healthRatio health maxHealth
	jump CheckTarget greaterThan healthRatio 0.5

	CallRepair:
		op add repairReturn @counter 1
		jump Repair always
	jump Start always

CheckTarget:
	jump FindEnemy equal targetType "unit"
	jump FindBuilding equal targetType "building"
	jump StopShooting always

FindBuilding:
	ulocate building turret true 0 targetX targetY found target
	jump ApproachBuilding equal found true
	ulocate building core true 0 targetX targetY found target
	jump StopShooting equal found false

ApproachBuilding:
	ucontrol within targetX targetY range isNear
	jump ShootBuilding equal isNear true
	ucontrol approach targetX targetY range
	jump Start always

ShootBuilding:
	ucontrol target targetX targetY 1
	jump Start always

FindEnemy:
	radar enemy any any distance scout 1 enemy
	jump AttackUnit notEqual enemy null
	uradar enemy ground any distance 0 1 enemy
	jump AttackUnit notEqual enemy null
	uradar enemy any any distance 0 1 enemy
	jump StopShooting equal enemy null
	
AttackUnit:
	sensor enemyDead enemy @dead
	jump StopShooting equal enemyDead true

ApproachEnemy:
	sensor enemyX enemy @x
	sensor enemyY enemy @y
	ucontrol within enemyX enemyY range isNear
	jump ShootEnemy equal isNear true
	ucontrol approach enemyX enemyY range
	jump Start always

ShootEnemy:
	ucontrol targetp enemy 1
	jump Start always

StopShooting:
	ucontrol targetp null 0
	ucontrol target null
	jump Start always

Stopping:
	set enemy null
	set mode stopping
	set firstStopping null

	BindForStop:
		ubind unitType
		jump FinishStop equal @unit null
		jump FinishStop equal firstStopping @unit
		jump StopUnit notEqual firstStopping null
		set firstStopping @unit 

	StopUnit:
		ucontrol targetp null 0
		ucontrol target null

		CallRepair:
			op add repairReturn @counter 1
			jump Repair always
		jump BindForStop always

	FinishStop:
		set mode idle
		set enemy null
		set firstStopping null
		jump Start always

Repair:
	ulocate building repair false 0 repairX repairY repairFound repairPoint
	jump RepairReturn equal repairFound false
	ucontrol within repairX repairY 5 isNearRepair
	jump RepairReturn equal isNearRepair true

	ApproachRepair:
		ucontrol approach repairX repairY 5

	RepairReturn:
		set @counter repairReturn




	

	