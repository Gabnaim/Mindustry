Initialize:
	set unitType @poly
	set switch switch1
	op shl procId @thisx 10 # first 10 bit for x
	op add procId procId @thisy # second 10 bit for y
	op shl startFlag procId 1 	#set bit after id to 0
	op add endFlag startFlag 1 	#set bit after id to 1

	InitWaypoints:
		set exactCoords false #edit to true for manual setting
		jump ExactCoords equal exactCoords true

		OffsetFromHere:
			set patrolRangeX 20
			set patrolRangeY 20
			set offsetX 10
			set offsetY 10
			op add baseX @thisx offsetX
			op add baseY @thisy offsetY
			op sub startX baseX patrolRangeX
			op sub startY baseY patrolRangeY
			op add endX baseX patrolRangeX
			op add endY baseY patrolRangeY
			jump Start always

		ExactCoords:
			set startX 89
			set startY 146
			set endX 142
			set endY 148
			jump Start always
	
Start:
CheckActive:
	sensor active switch @enabled
	op equal releaseUnits active false
	
BindUnit:
	ubind unitType
	jump BindUnit equal @unit null
	sensor dead @unit @dead
	jump BindUnit equal dead true
	sensor flag @unit @flag
	jump UseUnit equal flag startFlag
	jump UseUnit equal flag endFlag
	jump GrabUnit equal flag procId
	jump BindUnit notEqual flag 0

GrabUnit:
	jump Start equal releaseUnits true
	ucontrol flag startFlag

UseUnit:
	jump FindTarget equal releaseUnits false

ReleaseUnit:
	ucontrol flag 0
	jump Start always

FindTarget:
	uradar enemy any any distance 0 1 target
	jump SetWaypoints equal target null
	sensor range @unit @range
	sensor targX target @x
	sensor targY target @y
	ucontrol approach targX targY range
	ucontrol targetp target true range
	jump Start always

SetWaypoints:
	sensor flag @unit @flag
	jump SetEndPoint equal flag endFlag

SetStartPoint:
	set targX startX
	set targY startY
	jump CheckProgress always

SetEndPoint:
	set targX endX
	set targY endY

CheckProgress:
	ucontrol within targX targY 2 atDestination
	jump AtDestination equal atDestination true

Move:
	ucontrol move targX targY
	jump Start always

AtDestination:
	jump TurnBack equal flag startFlag

TurnForward:
	ucontrol flag startFlag
	jump Start always

TurnBack:
	ucontrol flag endFlag
	jump Start always
