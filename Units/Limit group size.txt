Initialize:
	set maxUnits 4
	set unitType @flare
	set runCount 0

GetLinks:
	set switch switch1
	jump GetLinks equal switch null

Start:	
CheckActive:
	sensor active switch @enabled
	jump Bind equal active true

	set unitCount 0
	set runCount 0
	set runFlag 0
	set firstUnit null
	jump Start always
	
Bind:
	ubind unitType
	jump Start equal @unit null
	jump FinishCount equal firstUnit @unit
	jump CheckUnit notEqual firstUnit null

SaveFirst:
	set firstUnit @unit

CheckUnit:
	sensor isDead @unit @dead
	jump Start equal isDead true

	# ignore unit if max is reached
	jump IgnoreUnit greaterThanEq unitCount maxUnits

ProcessUnit:
	 # do stuff with unit
	op add processFlag unitCount 1
	op add processFlag processFlag runFlag
	ucontrol flag processFlag
	jump Next always

IgnoreUnit:
	op mul ignoreFlag runFlag 10
	op add ignoreFlag ignoreFlag 99
	ucontrol flag ignoreFlag

Next:
	op add unitCount unitCount 1
	jump Start notEqual unitCount maxUnits

MaxReached:
	sensor currentFlag @unit @flag
	op add maxFlag currentFlag 100
	ucontrol flag maxFlag
	print "Max reached at "
	print unitCount
	print "\n"
	jump Start always

FinishCount:
	set lastCount unitCount
	set unitCount 0
	set firstUnit null
	op add runCount runCount 1
	op mul runFlag runCount 10

	print "Total: "
	print lastCount
	printflush message1
	jump Start always


	


