Initialize:
	printflush message1
	set maxIndex 37 #Serpulo
	set showCarried true
	set showEmpty true

Start:
GetUnitType:
	lookup unit unitType unitIndex
	set firstUnit null
	set units 0

BindUnit:
	ubind unitType
	jump NextUnitType equal @unit null
  	jump ProcessUnit notEqual firstUnit null
	
StartGroup:
	set firstUnit @unit
	jump BindUnit always

ProcessUnit:
	sensor flag @unit @flag
	op notEqual hasFlag flag 0
	set hasItems false
	jump PrintInfo equal showCarried false
	sensor carried @unit @totalItems
	op greaterThan hasItems carried 0
	sensor material @unit @firstItem

	PrintInfo:
		op or hasData hasFlag hasItems
		op or printLine hasData showEmpty
		jump FinishUnit equal printLine false
		print flag
		jump PrintEnd equal hasItems false
		print " "
		print carried
		print " "
		print material

	PrintEnd:
		print "\n"
	
FinishUnit:
	#op equal isStart units 0
	op add units units 1
	#jump BindUnit equal isStart true
	jump BindUnit notEqual firstUnit @unit

FinishGroup:
	print unitType
	print ": "
	print units
	print "\n"

NextUnitType:
	op add unitIndex unitIndex 1
	jump GetUnitType lessThanEq unitIndex maxIndex
	
Finish:
	set unitIndex 0
	printflush message1
	jump Start always
